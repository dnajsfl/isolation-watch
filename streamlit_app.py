import streamlit as st
import pandas as pd
from datetime import datetime

# =========================
# 기본 설정
# =========================
st.set_page_config(
    page_title="고립사 예방 모니터링",
    layout="centered"
)

# =========================
# 제목 / 개요
# =========================
st.title("고립사 예방 생활 반응 모니터링")

st.info(
    "본 웹앱은 독거 가구의 생활 반응 여부를 간접적으로 확인하여 "
    "고립 위험을 조기에 인지하는 것을 목표로 한 시연용 프로토타입이다.\n\n"
    "직접적인 생체 정보나 감시는 사용하지 않으며, "
    "일정 시간 동안 반응이 없을 경우 주의 신호로 표시한다."
)

st.divider()

# =========================
# (시연용) 데이터
# =========================
# 실제 환경에서는 센서 또는 서버에서 받아오는 값
status = "inactive"  # active / inactive
last_detected = "2025-12-21 14:30"
today_count = 2

# =========================
# 현재 상태 표시
# =========================
st.subheader("현재 상태")

if status == "active":
    st.success("정상: 최근 생활 반응이 감지되었습니다.")
else:
    st.error("주의: 일정 시간 동안 생활 반응이 감지되지 않았습니다.")

st.caption(
    "※ 경고 기준: 일정 시간(예: 12시간) 동안 "
    "센서 반응이 감지되지 않을 경우 주의 상태로 표시된다."
)

st.divider()

# =========================
# 상태 표시 박스 (발표용 강조)
# =========================
st.subheader("상태 요약")

if status == "active":
    st.markdown(
        """
        🟢 **정상 상태**  
        - 최근 30초 이내 생활 반응 감지  
        - 현재 위험 신호 없음
        """
    )
else:
    st.markdown(
        """
        🔴 **무활동 감지**  
        - 일정 시간(30초) 이상 반응 없음  
        - 버저 및 경고 신호 발생  
        - 기록이 서버 및 웹앱에 저장됨
        """
    )

# =========================
# 핵심 지표
# =========================
col1, col2, col3 = st.columns(3)

with col1:
    st.metric("마지막 감지 시간", last_detected)

with col2:
    st.metric("오늘 감지 횟수", today_count)

with col3:
    st.metric("현재 상태", "정상" if status == "active" else "반응 없음")

st.divider()

# =========================
# 활동 기록 시각화
# =========================
st.subheader("오늘의 생활 반응 기록")

data = pd.DataFrame({
    "시간": ["09:00", "12:00", "15:00", "18:00"],
    "감지 여부": [1, 1, 0, 0]
})

st.line_chart(data.set_index("시간"))

st.divider()

# =========================
# 시연용 버튼
# =========================
st.subheader("시연")

if st.button("생활 반응 감지 시뮬레이션"):
    st.success("생활 반응이 감지되었습니다.")
    st.caption("※ 실제 환경에서는 센서 입력에 의해 자동으로 갱신됩니다.")

st.divider()

# =========================
# 프로젝트 구조 설명
# =========================
st.subheader("프로젝트 구성")

st.markdown(
    """
    - **센서 로봇**: 움직임·소리 등 생활 반응을 감지  
    - **서버**: 데이터를 저장하고 상태를 판단  
    - **웹앱**: 상태를 시각적으로 표시하여 보호자·관리자가 확인
    """
)

# =========================
# 하단 설명
# =========================
st.caption(
    "본 웹앱은 고립사 예방을 위한 기술적 가능성을 탐구하기 위한 "
    "교육용 프로토타입이다."
)
